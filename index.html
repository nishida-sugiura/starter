




<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>LIFF Starter</title>
        <link rel="stylesheet" href="style.css">
        
        

        
    </head>
    

    
    <body>
        <div id="liffAppContent">
            <!-- ACTION BUTTONS -->
            <div class="buttonGroup">
               
                
                
                
                
                
                
                
                
                <div class="buttonRow">    
                    <button id="getProfileButton">Get Profile</button>
                </div>
                
          <div class="buttonRow">
                    <button id="shareTargetPicker">Open Share Target Picker</button>
                </div>
            </div>
  

            <!-- PROFILE INFO -->
            <div id="profileInfo"  class="hidden textLeft">
                <h2>Profile</h2>
                <a href="#" onclick="toggleProfileData()">Close Profile</a>
                <div id="profilePictureDiv">
                </div>
                <table>
                    <tr>
                        <th>userId</th>
                        <td id="userIdProfileField"></td>
                    </tr>
                    <tr>
                        <th>displayName</th>
                        <td id="displayNameField"></td>
                    </tr>
                    <tr>
                        <th>statusMessage</th>
                        <td id="statusMessageField"></td>
                    </tr>
                </table>
            </div>
            
            
            
            
            
            
            <!-- LIFF DATA -->
            <div id="liffData">
                <h2 id="liffDataHeader" class="textLeft">LIFF Data</h2>
               
               
                
                
                
            </div>
            <!-- LOGIN LOGOUT BUTTONS -->
            <div class="buttonGroup">
                <button id="liffLoginButton">Log in</button>
                <button id="liffLogoutButton">Log out</button>
            </div>
            <div id="statusMessage">
                <div id="isInClientMessage"></div>
                <div id="apiReferenceMessage">
                    <p>Available LIFF methods vary depending on the browser you use to open the LIFF app.</p>
                    <p>Please refer to the <a href="https://developers.line.biz/en/reference/liff/#initialize-liff-app">API reference page</a> for more information.</p>
                </div>
            </div>
        </div>
        <!-- LIFF ID ERROR -->
        <div id="liffIdErrorMessage" class="hidden">
            <p>You have not assigned any value for LIFF ID.</p>
            <p>If you are running the app using Node.js, please set the LIFF ID as an environment variable in your Heroku account follwing the below steps: </p>
            <code id="code-block">
                <ol>
                    <li>Go to `Dashboard` in your Heroku account.</li>
                    <li>Click on the app you just created.</li>
                    <li>Click on `Settings` and toggle `Reveal Config Vars`.</li>
                    <li>Set `MY_LIFF_ID` as the key and the LIFF ID as the value.</li>
                    <li>Your app should be up and running. Enter the URL of your app in a web browser.</li>
                </ol>
            </code>
            <p>If you are using any other platform, please add your LIFF ID in the <code>index.html</code> file.</p>
            <p>For more information about how to add your LIFF ID, see <a href="https://developers.line.biz/en/reference/liff/#initialize-liff-app">Initializing the LIFF app</a>.</p>
        </div>
        <!-- LIFF INIT ERROR -->
        <div id="liffInitErrorMessage" class="hidden">
            <p>Something went wrong with LIFF initialization.</p>
            <p>LIFF initialization can fail if a user clicks "Cancel" on the "Grant permission" screen, or if an error occurs in the process of <code>liff.init()</code>.</p>
        </div>
        <!-- NODE.JS LIFF ID ERROR -->
        <div id="nodeLiffIdErrorMessage" class="hidden">
            <p>Unable to receive the LIFF ID as an environment variable.</p>
        </div>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <p>デポジット用のIDを入力してください。<br></p>


  <textarea id="textArea" rows="1" cols="12"></textarea>


   <button id="postButton" onclick="">APPPZZ送信するA</button>
  <br>
  <button id="getButton">確認する</button>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        
        
        
        
        
        
        

      
      
      
  <script>   
 
     
     
       
    //GAS WebアプリのURL HTML_to_GAS_deposit

//const END_POINT ="https://script.google.com/macros/s/AKfycbzaxbellO8xgR3KCMqzfLkzYpg8ZC-mJbodMkDiTh9fJyujdy59zhxirp0FAkvzTE3F/exec";
//   const END_POINT ="https://script.google.com/macros/s/AKfycbzTTP4e55HvZtNK9KV2oYdBlU3cRlxL2w6hEUrqIZ_6mP1pdp4yUiPojlwkJHF9RePU/exec";
const END_POINT = "https://script.google.com/macros/s/AKfycbyR8TKg_rO1wbj4AR8KOKd5Wq46GdBbQrC07rYHsvlvnWsUdSlPYFxbJaq-dM2IZGqK/exec";     
      
//const END_POINT = "https://script.google.com/macros/s/AKfycby4ibg1Y_JZv7yPMPjqglSPfqOwK4R43ju2qu5-PcqVsfByfd1uAPB2bLUctZrWwZU7/exec";

    //読み書きするスプレッドシート（タブ）の番号
    const SHEET_NO = 1; 
    document.getElementById("postButton").addEventListener('click', registerButtonHandlers, false);
    document.getElementById("getButton").addEventListener('click', getFromGAS, false);
    let dataObj = {};
    
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
     function postToGAS(uid) {      
   
    // get profile call
    document.getElementById('getProfileButton').addEventListener('click', function() {
        liff.getProfile().then(function(profile) {
            
let dsp_name = profile.displayName;
const uid = profile.userId;        
   
            
            
            
            
     
            
            
            const Content0 = document.getElementById("textArea").value.trim();
      console.log(Content0);

//let Content = [];

let Content =JSON.stringify([Content0+uid]);


      //データがJSONかどうかのチェック
      try {
       const checkJSON = JSON.parse(Content);
     

 if (checkJSON.length > 0 && Object.keys(checkJSON).length > 0) {
        console.log("data is OK");
       } else {
         throw "data is not array of object";
       }

     }




      catch (e) {
        alert("error:" + e);
        return;
      }



      //POST送信
      $.ajax({
        type: "POST",
        url: END_POINT,
        dataType: "json",
        data: { data: Content }
      })
        .then(
          (result) => { // 成功した時の処理
            console.log(JSON.stringify(result));
          },
          (error) => { // 失敗した時の処理
            alert('Error:' + JSON.stringify(error));
          }
        );
    }    
            
            
            
            
            
            
            
              
      
        
        
        
        
        
        
        
        
    function getFromGAS() {
      $.ajax({
        type: "GET",
        url: END_POINT,
        data: { sheetNo: SHEET_NO }
      }).done((result) => {        // 成功した時の処理
        dataObj = JSON.parse(result);
        document.getElementById("textArea").value = result;
        console.log("get done:" + result);
      }).fail((error) => {  // 失敗した時の処理
        alert('Error:' + JSON.stringify(error));
      }).always((data) => {// 常にやる処理
        // do something
      });
    }
      
//function clearTextarea() {
//	var textareaForm = document.getElementById("textArea");
// textareaForm.value = '';}

 

          

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
      
window.onload = function() {
    const useNodeJS = false;   // if you are not using a node server, set this value to false
    const defaultLiffId = "1657192220-EKGPj8q3";   // change the default LIFF value if you are not using a node server

    // DO NOT CHANGE THIS
    let myLiffId = "";

    // if node is used, fetch the environment variable and pass it to the LIFF method
    // otherwise, pass defaultLiffId
    if (useNodeJS) {
        fetch('/send-id')
            .then(function(reqResponse) {
                return reqResponse.json();
            })
            .then(function(jsonResponse) {
                myLiffId = jsonResponse.id;
                initializeLiffOrDie(myLiffId);
            })
            .catch(function(error) {
                document.getElementById("liffAppContent").classList.add('hidden');
                document.getElementById("nodeLiffIdErrorMessage").classList.remove('hidden');
            });
    } else {
        myLiffId = defaultLiffId;
        initializeLiffOrDie(myLiffId);
    }
};

/**
* Check if myLiffId is null. If null do not initiate liff.
* @param {string} myLiffId The LIFF ID of the selected element
*/
function initializeLiffOrDie(myLiffId) {
    if (!myLiffId) {
        document.getElementById("liffAppContent").classList.add('hidden');
        document.getElementById("liffIdErrorMessage").classList.remove('hidden');
    } else {
        initializeLiff(myLiffId);
    }
}

/**
* Initialize LIFF
* @param {string} myLiffId The LIFF ID of the selected element
*/
function initializeLiff(myLiffId) {
    liff
        .init({
            liffId: myLiffId
        })
        .then(() => {
            // start to use LIFF's api
            initializeApp();
        })
        .catch((err) => {
            document.getElementById("liffAppContent").classList.add('hidden');
            document.getElementById("liffInitErrorMessage").classList.remove('hidden');
        });
}

/**
 * Initialize the app by calling functions handling individual app components
 */
function initializeApp() {

    displayIsInClientInfo();
    registerButtonHandlers();

    // check if the user is logged in/out, and disable inappropriate button
    if (liff.isLoggedIn()) {
        document.getElementById('liffLoginButton').disabled = true;
    } else {
        document.getElementById('liffLogoutButton').disabled = true;
    }
}







/**
* Toggle the login/logout buttons based on the isInClient status, and display a message accordingly
*/
function displayIsInClientInfo() {
    if (liff.isInClient()) {
        document.getElementById('liffLoginButton').classList.toggle('hidden');
        document.getElementById('liffLogoutButton').classList.toggle('hidden');
        document.getElementById('isInClientMessage').textContent = 'You are opening the app in the in-app browser of LINE.';
    } else {
        document.getElementById('isInClientMessage').textContent = 'You are opening the app in an external browser.';
        document.getElementById('shareTargetPicker').classList.toggle('hidden');
    }
}








/**
* Register event handlers for the buttons displayed in the app
*/
function registerButtonHandlers() {



    // get profile call
    document.getElementById('getProfileButton').addEventListener('click', function() {
        liff.getProfile().then(function(profile) {
            
let dsp_name = profile.displayName;
const uid = profile.userId;        
            
            document.getElementById('userIdProfileField').textContent = profile.userId+"$$$"+dsp_name;
            document.getElementById('displayNameField').textContent = profile.displayName+"$$$"+uid;



postToGAS(uid)
            
            
            
            
            
            
            

            const profilePictureDiv = document.getElementById('profilePictureDiv');
            if (profilePictureDiv.firstElementChild) {
                profilePictureDiv.removeChild(profilePictureDiv.firstElementChild);
            }
            const img = document.createElement('img');
            img.src = profile.pictureUrl;
            img.alt = 'Profile Picture';
            profilePictureDiv.appendChild(img);






            document.getElementById('statusMessageField').textContent = profile.statusMessage;
            toggleProfileData();
        }).catch(function(error) {
            window.alert('Error getting profile: ' + error);
        });
    });

    document.getElementById('shareTargetPicker').addEventListener('click', function () {
        if (liff.isApiAvailable('shareTargetPicker')) {
            liff.shareTargetPicker([{
                'type': 'text',
                'text': 'Hello, World!'
            }]).then(
                document.getElementById('shareTargetPickerMessage').textContent = "Share target picker was launched."
            ).catch(function (res) {
                document.getElementById('shareTargetPickerMessage').textContent = "Failed to launch share target picker.";
            });
        }
    });

    // login call, only when external browser is used
    document.getElementById('liffLoginButton').addEventListener('click', function() {
        if (!liff.isLoggedIn()) {
            // set `redirectUri` to redirect the user to a URL other than the front page of your LIFF app.
            liff.login();
        }
    });

    // logout call only when external browse
    document.getElementById('liffLogoutButton').addEventListener('click', function() {
        if (liff.isLoggedIn()) {
            liff.logout();
            window.location.reload();
        }
    });
}

/**
* Alert the user if LIFF is opened in an external browser and unavailable buttons are tapped
*/
function sendAlertIfNotInClient() {
    alert('This button is unavailable as LIFF is currently being opened in an external browser.');
}

/**
* Toggle access token data field
*/
function toggleAccessToken() {
    toggleElement('accessTokenData');
}

/**
* Toggle profile info field
*/
function toggleProfileData() {
    toggleElement('profileInfo');
}

/**
* Toggle scanCode result field
*/
function toggleQrCodeReader() {
    toggleElement('scanQr');
}

/**
* Toggle specified element
* @param {string} elementId The ID of the selected element
*/
function toggleElement(elementId) {
    const elem = document.getElementById(elementId);
    if (elem.offsetWidth > 0 && elem.offsetHeight > 0) {
        elem.style.display = 'none';
    } else {
        elem.style.display = 'block';
    }
}  
        
        
        
        
        
        
        
        
        
        
        
        
        
                       
 </script>
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
       <script src="liff-starter.js"></script>
    </body>
</html>

